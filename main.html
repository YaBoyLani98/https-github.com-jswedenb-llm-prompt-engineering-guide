<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>7-Day Weather App + AI Chat</title>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<!-- Babel -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
  body { font-family: Arial, sans-serif; background-color: #2C2C2C; margin: 0; padding: 20px; text-align: center; color: white; }
  
  /* Header for top-left button */
  .header {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 100;
  }
  .header a {
    color: #FF5733;
    font-size: 20px;
    text-decoration: none;
    font-weight: bold;
  }
  .header a:hover {
    text-decoration: underline;
  }

  .title { font-size: 36px; color: #FF5733; margin-bottom: 25px; }
  .title span { display: inline-block; }

  /* Jump animation */
  .jump { animation: jump 1s ease; }
  @keyframes jump {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-25px); }
    60% { transform: translateY(-15px); }
  }

  .autocomplete { position: relative; display: inline-block; width: 240px; margin-right: 10px; }
  .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.35); max-height: 180px; overflow-y: auto; z-index: 20; text-align: left; color:black; }
  .suggestions div { padding: 8px; cursor: pointer; font-size: 14px; }
  .suggestions div:hover { background-color: #0288d1; color: white; }

  .button { padding: 10px 20px; font-size: 16px; margin-bottom: 20px; border-radius: 8px; background-color: #0288d1; color: white; border: none; cursor: pointer; }
  .grid { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
  .card { position: relative; background-color: #ffffff; padding: 15px; border-radius: 12px; width: 180px; border: 3px solid #d19002; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transition: transform 0.25s ease, box-shadow 0.3s ease, border-color 0.3s ease; overflow: hidden; color:black; }
  .card:hover { transform: translateY(-6px) scale(1.05); border-color: #ff8c00; box-shadow: 0 0 12px #ff8c00, 0 0 22px #ff8c00; }
  .day { font-weight: bold; margin-bottom: 10px; font-size: 18px; }

  .weather-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; border-radius: 12px; text-transform: capitalize; font-size: 14px; }
  .card:hover .weather-overlay { opacity: 1; }
  .weather-overlay img { width: 60px; height: 60px; }

  .chatbox { position: fixed; bottom: 20px; right: 20px; width: 300px; max-height: 400px; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; z-index: 50; color:black; }
  .chat-messages { flex: 1; padding: 10px; overflow-y: auto; }
  .chat-messages div { margin: 6px 0; }
  .chat-input { display: flex; border-top: 1px solid #ccc; }
  .chat-input input { flex: 1; padding: 8px; border: none; outline: none; }
  .chat-input button { padding: 8px; background: #0288d1; color: white; border: none; cursor: pointer; }
</style>
</head>
<body>

<!-- Top-left WeatherNature button -->
<div class="header">
  <a href="index.html">WeatherNature</a>
</div>

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// ===== Animated Title =====
function AnimatedTitle({ text }) {
  const [animate, setAnimate] = useState(false);
  useEffect(() => {
    const interval = setInterval(() => {
      setAnimate(true);
      setTimeout(() => setAnimate(false), 1000); // match jump duration
    }, 9000); // every 9 seconds
    return () => clearInterval(interval);
  }, []);
  return (
    <h1 className="title">
      {text.split("").map((char, i) => (
        <span key={i} className={animate ? "jump" : ""} style={{ animationDelay: `${i*0.05}s` }}>
          {char === " " ? "\u00A0" : char}
        </span>
      ))}
    </h1>
  );
}

// ===== Weather App =====
function WeatherApp({ onWeatherUpdate }) {
  const [city, setCity] = useState("");
  const [suggestions, setSuggestions] = useState([]);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [weatherData, setWeatherData] = useState(Array(7).fill({
    temp: "--", humidity: "--", wind: "--", precipitation: "--", description: "", icon: ""
  }));

  const fetchCitySuggestions = async (value) => {
    if(value.length < 2){ setSuggestions([]); setShowSuggestions(false); return; }
    try {
      const API_KEY = "6a6cf4a74cf6beb5bcfa1a7179178118";
      const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${value}&limit=5&appid=${API_KEY}`);
      const data = await res.json();
      setSuggestions(data);
      setShowSuggestions(true);
    } catch {
      setSuggestions([]);
    }
  };

  const fetchWeather = async () => {
    try {
      const API_KEY = "6a6cf4a74cf6beb5bcfa1a7179178118";
      const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${API_KEY}`);
      const geoData = await geoRes.json();
      if(!geoData.length) throw new Error();
      const { lat, lon } = geoData[0];
      const weatherRes = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&units=metric&exclude=minutely,hourly,alerts&appid=${API_KEY}`);
      const data = await weatherRes.json();
      const updated = data.daily.slice(0,7).map(entry => ({
        temp: ((entry.temp.day*9)/5+32).toFixed(1),
        humidity: entry.humidity,
        wind: entry.wind_speed,
        precipitation: Math.round(entry.pop*100),
        description: entry.weather[0].description,
        icon: entry.weather[0].icon
      }));
      setWeatherData(updated);

      const summary = updated.map((d,i)=>{
        const date = new Date(); date.setDate(date.getDate()+i);
        return `${date.toLocaleDateString("en-US",{ weekday:"long" })}: ${d.description}, Temp: ${d.temp}°F, Humidity: ${d.humidity}%, Wind: ${d.wind} m/s, Precipitation: ${d.precipitation}%`;
      }).join("\n");
      onWeatherUpdate(summary);

    } catch {
      alert("Weather fetch failed");
    }
  };

  return (
    <div>
      <AnimatedTitle text="7-Day Weather Forecast" />
      <div className="autocomplete">
        <input
          type="text"
          value={city}
          onChange={(e) => { setCity(e.target.value); fetchCitySuggestions(e.target.value); }}
          placeholder="Enter city"
          style={{ padding: "8px", fontSize: "16px", width: "100%" }}
        />
        {showSuggestions && suggestions.length > 0 && (
          <div className="suggestions">
            {suggestions.map((item, i) => (
              <div key={i} onClick={() => { setCity(`${item.name}, ${item.country}`); setSuggestions([]); setShowSuggestions(false); }}>
                {item.name}{item.state ? `, ${item.state}` : ""} ({item.country})
              </div>
            ))}
          </div>
        )}
      </div>
      <button className="button" onClick={fetchWeather}>Update Weather</button>
      <div className="grid">
        {weatherData.map((entry,i) => {
          const date = new Date(); date.setDate(date.getDate()+i);
          return (
            <div key={i} className="card">
              <div className="day">
                {date.toLocaleDateString("en-US",{ weekday:"long" })}<br/>
                <span style={{ fontSize:"14px", color:"#555" }}>{date.toLocaleDateString("en-US",{ month:"short", day:"numeric" })}</span>
              </div>
              <p><strong>Temp:</strong> {entry.temp}°F</p>
              <p><strong>Humidity:</strong> {entry.humidity}%</p>
              <p><strong>Wind:</strong> {entry.wind} m/s</p>
              <p><strong>Precip:</strong> {entry.precipitation}%</p>
              {entry.icon && (
              <div className="weather-overlay">
                <img src={`https://openweathermap.org/img/wn/${entry.icon}@2x.png`} />
                <strong>{entry.description}</strong>
                <p>{entry.temp}°F</p>
              </div>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

// ===== ChatBox =====
function ChatBox({ weatherSummary }) {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState("");

  const sendMessage = async () => {
    if(!input.trim()) return;

    const newMessages = [...messages, { role:"user", content: input }];
    setMessages(newMessages);

    const endpoint = "https://thefinal.openai.azure.com/openai/deployments/o3-mini/chat/completions?api-version=2025-01-01-preview";
    const payload = {
      messages: [
        { role:"system", content: `You are a helpful assistant. Here is the latest 7-day weather data:\n${weatherSummary}` },
        ...newMessages.map(m=>({ role: m.role, content: m.content }))
      ]
    };

    try {
      const response = await fetch(endpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "api-key": "6dXtOWT3WOzbadofxhUl44MAup3dmdlkT3mwkLR7uU4EaIEGRjBoJQQJ99BLACYeBjFXJ3w3AAABACOGIAYB"
        },
        body: JSON.stringify(payload)
      });
      if(!response.ok) throw new Error(response.statusText);
      const data = await response.json();
      const aiMessage = data.choices[0].message.content;
      setMessages([...newMessages, { role:"assistant", content: aiMessage }]);
      setInput("");
    } catch (err) {
      console.error(err);
      alert("Failed to get AI response.");
    }
  };

  return (
    <div className="chatbox">
      <div className="chat-messages">
        {messages.map((m,i)=>(
          <div key={i} style={{ textAlign: m.role==="user"?"right":"left" }}>
            <span style={{
              display:"inline-block",
              background: m.role==="user"?"#0288d1":"#eee",
              color: m.role==="user"?"#fff":"#000",
              padding:"6px 10px",
              borderRadius:"12px"
            }}>
              {m.content}
            </span>
          </div>
        ))}
      </div>
      <div className="chat-input">
        <input
          value={input}
          onChange={e=>setInput(e.target.value)}
          placeholder="Ask me about the weather..."
          onKeyDown={e=>{ if(e.key==="Enter") sendMessage(); }}
        />
        <button onClick={sendMessage}>Send</button>
      </div>
    </div>
  );
}

// ===== Render App =====
function App() {
  const [weatherSummary, setWeatherSummary] = useState("");
  return (
    <>
      <WeatherApp onWeatherUpdate={setWeatherSummary} />
      <ChatBox weatherSummary={weatherSummary} />
    </>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
</script>
</body>
</html>
